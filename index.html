<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FPS Gameplay Review Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Tailwind CSS and DaisyUI -->
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.13/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Custom Styles -->
  <style>
    /* Sidebar Styling */
    .sidebar {
      width: 250px;
      transition: transform 0.3s ease-in-out;
      transform: translateX(-250px);
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      z-index: 1000;
    }
    .sidebar.open {
      transform: translateX(0);
    }

    /* Overlay when Sidebar is Open */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-in-out;
      z-index: 999;
    }
    .overlay.active {
      opacity: 1;
      visibility: visible;
    }

    /* Video Grid for Team POV */
    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }

    /* Timeline Marker */
    .timeline-marker {
      position: absolute;
      height: 100%;
      width: 4px;
      background-color: #f1c40f;
      cursor: pointer;
    }

    .current-comment {
      border: 2px solid #4CAF50;
      transform: scale(1.02);
      transition: all 0.3s ease;
      background-color: #e0ffe0; /* Light green background for emphasis */
    }

    /* Toast Container */
    #toast-container {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      z-index: 1001;
    }

    /* Tooltip Styling (Using DaisyUI) */
    .tooltip {
      position: relative;
    }

    .tooltip:hover::after {
      content: attr(data-tip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: #fff;
      padding: 0.5rem;
      border-radius: 0.25rem;
      white-space: nowrap;
      z-index: 1002;
      opacity: 1;
      transition: opacity 0.2s ease-in-out;
    }

    .tooltip::after {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-width: 5px;
      border-style: solid;
      border-color: transparent transparent #333 transparent;
      opacity: 0;
      transition: opacity 0.2s ease-in-out;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <!-- Sidebar Navigation -->
  <div id="sidebar" class="sidebar bg-base-100 shadow-lg p-4">
    <h2 class="text-2xl font-bold mb-6 text-center">Navigation</h2>
    <ul class="menu p-0 space-y-2">
      <li>
        <button id="nav-home" class="btn btn-ghost w-full text-left flex items-center space-x-2">
          <!-- Home Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M13 5v6h6" />
          </svg>
          <span>Home</span>
        </button>
      </li>
      <li>
        <button id="nav-video-list" class="btn btn-ghost w-full text-left flex items-center space-x-2">
          <!-- Video List Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <span>Video List</span>
        </button>
      </li>
      <li>
        <button id="nav-team-pov" class="btn btn-ghost w-full text-left flex items-center space-x-2">
          <!-- Team POV Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-5m-5 0L12 12m5 8V20M7 20H2v-5m5 0L12 12m-5 8V20" />
          </svg>
          <span>Team POV</span>
        </button>
      </li>
      <li>
        <button id="nav-settings" class="btn btn-ghost w-full text-left flex items-center space-x-2">
          <!-- Settings Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.978a1 1 0 00.95.69h4.164c.969 0 1.371 1.24.588 1.81l-3.37 2.448a1 1 0 00-.364 1.118l1.286 3.978c.3.921-.755 1.688-1.54 1.118l-3.37-2.448a1 1 0 00-1.175 0l-3.37 2.448c-.784.57-1.838-.197-1.54-1.118l1.286-3.978a1 1 0 00-.364-1.118L2.515 9.405c-.783-.57-.38-1.81.588-1.81h4.164a1 1 0 00.95-.69l1.286-3.978z" />
          </svg>
          <span>Settings</span>
        </button>
      </li>
    </ul>
  </div>

  <!-- Overlay -->
  <div id="overlay" class="overlay"></div>

  <!-- Main Content Area -->
  <div class="flex-1 p-6 ml-0 md:ml-0">
    <!-- Header with Toggle Button -->
    <div class="flex justify-between items-center mb-4">
      <button id="toggle-sidebar" class="btn btn-square btn-ghost">
        <!-- Hamburger Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
      <h1 class="text-3xl font-bold">FPS Gameplay Review Tool</h1>
      <div></div> <!-- Placeholder for alignment -->
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 space-y-2"></div>

    <!-- Home View -->
    <div id="home-view" class="block">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Single Video Player -->
        <div class="card bg-base-100 shadow-lg p-4">
          <div id="player-home"></div>
        </div>

        <!-- Comments Section -->
        <div>
          <h4 class="text-lg font-semibold mb-4">Comments</h4>

          <!-- Search and Filter Controls -->
          <div class="mb-4">
            <input type="text" id="search-comments-home" class="input input-bordered w-full" placeholder="Search comments..." />
          </div>
          <div class="flex flex-col sm:flex-row sm:space-x-2 mb-4">
            <select id="filter-sentiment-home" class="select select-bordered mb-2 sm:mb-0">
              <option value="">All Sentiments</option>
              <option value="good">Good</option>
              <option value="warning">Warning</option>
              <option value="bad">Bad</option>
            </select>
            <select id="filter-category-home" class="select select-bordered mb-2 sm:mb-0">
              <option value="">All Categories</option>
              <option value="gameplay">Gameplay</option>
              <option value="crosshair">Crosshair Placement</option>
              <option value="movement">Movement</option>
            </select>
            <select id="sort-comments-home" class="select select-bordered">
              <option value="timestamp-asc">Time: Ascending</option>
              <option value="timestamp-desc">Time: Descending</option>
              <option value="sentiment">Sentiment</option>
              <option value="category">Category</option>
            </select>
          </div>

          <!-- Comment Feed -->
          <div id="comment-feed-home" class="overflow-y-auto bg-base-100 rounded-lg shadow-lg p-4 space-y-4 h-96">
            <!-- Comments will be dynamically populated -->
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex justify-center space-x-4 mt-4">
        <label for="commentModalToggle" class="btn btn-primary flex items-center space-x-2 cursor-pointer">
          <!-- Add Comment Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          <span>Add Comment</span>
        </label>
        <button id="prev-comment-home" class="btn flex items-center space-x-2">
          <!-- Previous Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          <span>Previous</span>
        </button>
        <button id="next-comment-home" class="btn flex items-center space-x-2">
          <span>Next</span>
          <!-- Next Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
        <button id="export-comments-home" class="btn btn-success flex items-center space-x-2">
          <!-- Export Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 12l5 5m0 0l5-5m-5 5V4" />
          </svg>
          <span>Share Comments</span>
        </button>
      </div>
    </div>

    <!-- Video List View (Initially Hidden) -->
    <div id="video-list-view" class="hidden">
      <h2 class="text-2xl font-bold mb-4">Video List</h2>
      <div class="space-y-6">
        <!-- Single View Videos -->
        <div>
          <h3 class="text-xl font-semibold mb-2">Single View Videos</h3>
          <div id="single-view-videos" class="space-y-4">
            <!-- Single view video items will be dynamically populated -->
          </div>
        </div>

        <!-- Team View Videos -->
        <div>
          <h3 class="text-xl font-semibold mb-2">Team View Videos</h3>
          <div id="team-view-videos" class="space-y-4">
            <!-- Team view video items will be dynamically populated -->
          </div>
        </div>

        <!-- Remove All Videos Button -->
        <div>
          <button id="remove-all-videos-list" class="btn btn-error w-full">Remove All Videos</button>
        </div>
      </div>
    </div>

    <!-- Team POV View (Initially Hidden) -->
    <div id="team-pov-view" class="hidden">
      <h2 class="text-2xl font-bold mb-4">Team POV</h2>
      <div class="flex flex-col space-y-4">
        <!-- Video Player Slots -->
        <div class="video-grid" id="team-video-grid">
          <!-- Player Slots will be dynamically populated -->
        </div>

        <!-- Synchronized Playback Buttons -->
        <div class="flex space-x-2">
          <button id="start-all" class="btn btn-primary flex-1">Start All Videos Simultaneously</button>
          <button id="pause-all" class="btn btn-secondary flex-1">Pause All Videos</button>
        </div>

        <!-- Save Team Setup Button -->
        <button id="save-team-setup" class="btn btn-secondary w-full">Save Current Team Setup</button>

        <!-- Comment Feed for Team POV -->
        <div>
          <h4 class="text-lg font-semibold mb-4">Team Comments</h4>
          <div id="comment-feed-team" class="overflow-y-auto bg-base-100 rounded-lg shadow-lg p-4 space-y-4 h-96">
            <!-- Team comments will be dynamically populated -->
          </div>
        </div>
      </div>
    </div>

    <!-- Settings View (Initially Hidden) -->
    <div id="settings-view" class="hidden">
      <h2 class="text-2xl font-bold mb-4">Settings</h2>
      <div class="card bg-base-100 shadow-lg p-4">
        <h3 class="text-lg font-semibold mb-2">Author Information</h3>
        <form id="settings-form" class="grid grid-cols-1 gap-4">
          <div>
            <label for="author-name" class="label">Author Name</label>
            <input type="text" id="author-name" class="input input-bordered w-full" placeholder="Enter your name" required />
          </div>
          <div class="modal-action">
            <button type="submit" class="btn btn-primary">Save Settings</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Comment Modal (DaisyUI Modal Implementation) -->
    <input type="checkbox" id="commentModalToggle" class="modal-toggle" />
    <div id="commentModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal-box relative">
        <!-- Close Button -->
        <label for="commentModalToggle" class="btn btn-sm btn-circle absolute right-2 top-2" aria-label="Close modal">✕</label>
        <h5 id="modal-title" class="font-bold text-lg mb-4">Add Comment</h5>
        <form id="comment-form" class="grid grid-cols-1 gap-4">
          <div>
            <label for="comment-text" class="label">Comment</label>
            <textarea id="comment-text" class="textarea textarea-bordered w-full focus:border-blue-500" rows="3" placeholder="Enter your feedback here..." required></textarea>
            <p class="text-red-500 text-sm hidden" id="comment-error">Comment cannot be empty.</p>
            <p class="text-gray-500 text-sm">Provide detailed feedback to help improve gameplay.</p>
          </div>
          <div>
            <label for="comment-sentiment" class="label">Sentiment</label>
            <select id="comment-sentiment" class="select select-bordered w-full" required>
              <option value="good">Good</option>
              <option value="warning">Warning</option>
              <option value="bad">Bad</option>
            </select>
          </div>
          <div>
            <label for="comment-category" class="label">Category</label>
            <select id="comment-category" class="select select-bordered w-full" required>
              <option value="gameplay">Gameplay</option>
              <option value="crosshair">Crosshair Placement</option>
              <option value="movement">Movement</option>
            </select>
          </div>
          <div class="modal-action">
            <label for="commentModalToggle" class="btn">Cancel</label>
            <button type="submit" class="btn btn-primary">Save Comment</button>
          </div>
        </form>
      </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <!-- YouTube Iframe API is loaded asynchronously above -->

    <!-- JavaScript -->
    <script>
      // Load YouTube Iframe API asynchronously
      let tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(tag);

      document.addEventListener('DOMContentLoaded', function() {
        'use strict';

        // Data Structures
        let players = {}; // To hold multiple YT.Player instances
        let currentVideoId = null; // For Home View
        let commentsData = JSON.parse(localStorage.getItem('commentsData')) || {};
        let loadedVideos = JSON.parse(localStorage.getItem('loadedVideos')) || [];
        let authorName = localStorage.getItem('authorName') || '';

        // Elements
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const toggleSidebarBtn = document.getElementById('toggle-sidebar');
        const navHome = document.getElementById('nav-home');
        const navVideoList = document.getElementById('nav-video-list');
        const navTeamPov = document.getElementById('nav-team-pov');
        const navSettings = document.getElementById('nav-settings');
        const videoListView = document.getElementById('video-list-view');
        const homeView = document.getElementById('home-view');
        const teamPovView = document.getElementById('team-pov-view');
        const settingsView = document.getElementById('settings-view');
        const singleViewContainer = document.getElementById('single-view-videos');
        const teamViewContainer = document.getElementById('team-view-videos');
        const removeAllVideosListBtn = document.getElementById('remove-all-videos-list');
        const startAllBtn = document.getElementById('start-all');
        const pauseAllBtn = document.getElementById('pause-all');
        const saveTeamSetupBtn = document.getElementById('save-team-setup');
        const settingsForm = document.getElementById('settings-form');
        const authorInput = document.getElementById('author-name');

        // Sidebar Toggle Functionality
        toggleSidebarBtn.addEventListener('click', () => {
          sidebar.classList.toggle('open');
          overlay.classList.toggle('active');
          console.log('Sidebar toggled.');
        });

        overlay.addEventListener('click', () => {
          sidebar.classList.remove('open');
          overlay.classList.remove('active');
          console.log('Sidebar closed via overlay.');
        });

        // Navigation Button Handlers
        navHome.addEventListener('click', () => {
          showView('home');
          console.log('Switched to Home view.');
        });

        navVideoList.addEventListener('click', () => {
          showView('video-list');
          console.log('Switched to Video List view.');
        });

        navTeamPov.addEventListener('click', () => {
          showView('team-pov');
          console.log('Switched to Team POV view.');
        });

        navSettings.addEventListener('click', () => {
          showView('settings');
          console.log('Switched to Settings view.');
        });

        // Function to Show Specific View
        function showView(view) {
          homeView.classList.add('hidden');
          videoListView.classList.add('hidden');
          teamPovView.classList.add('hidden');
          settingsView.classList.add('hidden');

          if (view === 'home') {
            homeView.classList.remove('hidden');
          } else if (view === 'video-list') {
            videoListView.classList.remove('hidden');
            populateVideoList();
          } else if (view === 'team-pov') {
            teamPovView.classList.remove('hidden');
            populateTeamPovList();
          } else if (view === 'settings') {
            settingsView.classList.remove('hidden');
            authorInput.value = authorName;
          }

          // Close Sidebar
          sidebar.classList.remove('open');
          overlay.classList.remove('active');
        }

        // Remove All Videos from Video List View
        removeAllVideosListBtn.addEventListener('click', () => {
          if (confirm('Are you sure you want to remove all videos? This action cannot be undone.')) {
            localStorage.removeItem('loadedVideos');
            localStorage.removeItem('commentsData');
            localStorage.removeItem('authorName');
            loadedVideos = [];
            commentsData = {};
            authorName = '';
            currentVideoId = null;
            updateUIAfterRemoval();
            showToast('All videos and comments have been removed.', 'success');
            console.log('All videos and comments removed from Video List view.');
          }
        });

        // Event Listener for Save Team Setup Button
        if (saveTeamSetupBtn) {
          saveTeamSetupBtn.addEventListener('click', () => {
            const teamVideoIds = getCurrentTeamVideoIds();
            if (teamVideoIds.length === 0) {
              showToast('No videos loaded in Team POV slots.', 'error');
              console.warn('Attempted to save empty team setup.');
              return;
            }

            const setupId = saveTeamSetup(teamVideoIds);
            showToast('Team setup saved successfully!', 'success');
            console.log(`Team setup ${setupId} saved.`);
          });
        }

        // Function to Get Current Team Video IDs
        function getCurrentTeamVideoIds() {
          const teamVideoIds = [];
          for (let i = 1; i <= 12; i++) {
            const playerIdentifier = `team-player${i}`;
            if (players[playerIdentifier] && players[playerIdentifier].getVideoData().video_id) {
              teamVideoIds.push(players[playerIdentifier].getVideoData().video_id);
            }
          }
          return teamVideoIds;
        }

        // Function to Generate Unique Identifier for Team Setup
        function generateTeamSetupId(videoIds) {
          return videoIds.sort().join('-');
        }

        // Function to Save Team Setup
        function saveTeamSetup(videoIds) {
          const setupId = generateTeamSetupId(videoIds);
          localStorage.setItem(`teamSetup-${setupId}`, JSON.stringify(videoIds));
          return setupId;
        }

        // Function to Load Team Setup
        function loadTeamSetup(setupId) {
          const videoIds = JSON.parse(localStorage.getItem(`teamSetup-${setupId}`));
          if (videoIds) {
            clearAllPlayers(); // Clear existing Team POV players
            videoIds.forEach((videoId, index) => {
              if (index < 12) { // Ensure we don't exceed 12 slots
                loadVideoIntoSlot(index + 1, videoId);
              }
            });
            loadCommentsForTeamSetup(setupId);
            showToast('Team setup loaded successfully!', 'success');
            console.log(`Team setup ${setupId} loaded.`);
          } else {
            showToast('Team setup not found.', 'error');
            console.error('Team setup not found.');
          }
        }

        // Function to Load Comments for Team Setup
        function loadCommentsForTeamSetup(setupId) {
          const commentFeed = document.getElementById('comment-feed-team');
          if (!commentFeed) {
            console.error('Comment feed for Team POV not found.');
            return;
          }
          commentFeed.innerHTML = '';

          if (commentsData[setupId]) {
            commentsData[setupId].forEach(comment => {
              addCommentToFeed(comment, 'team-pov');
            });
            console.log(`Loaded ${commentsData[setupId].length} comments for team setup ${setupId}.`);
          } else {
            console.log('No comments found for this team setup.');
          }
        }

        // Function to Create YouTube Player
        function createPlayer(playerIdentifier, videoId) {
          console.log(`Creating YouTube player for ${playerIdentifier} with Video ID: ${videoId}`);
          try {
            players[playerIdentifier] = new YT.Player(playerIdentifier, {
              height: '180',
              width: '320',
              videoId: videoId,
              events: {
                'onReady': () => onPlayerReady(playerIdentifier),
                'onStateChange': () => onPlayerStateChange(playerIdentifier)
              },
              playerVars: {
                'rel': 0,
                'showinfo': 0,
                'modestbranding': 1
              }
            });
          } catch (error) {
            console.error(`Error creating YouTube player ${playerIdentifier}:`, error);
            showToast(`Failed to initialize video player ${playerIdentifier}.`, 'error');
          }
        }

        // Function to Load Video into Home View
        function loadVideoById(videoId, title = 'Untitled Video') {
          console.log(`Loading Video ID: ${videoId} with title: ${title} into Home View.`);
          try {
            if (players['player-home'] && typeof players['player-home'].loadVideoById === 'function') {
              players['player-home'].loadVideoById(videoId);
            } else {
              // Create Home Player if not exists
              players['player-home'] = new YT.Player('player-home', {
                height: '390',
                width: '640',
                videoId: videoId,
                events: {
                  'onReady': onHomePlayerReady,
                  'onStateChange': onHomePlayerStateChange
                },
                playerVars: {
                  'rel': 0,
                  'showinfo': 0,
                  'modestbranding': 1
                }
              });
            }
            currentVideoId = videoId;
            loadCommentsForVideo(videoId, 'home');
            showToast(`Loaded video: ${title}`, 'success');
            console.log(`Loaded video: ${title} into Home View.`);
          } catch (error) {
            console.error('Error loading video by ID into Home View:', error);
            showToast('Failed to load video.', 'error');
          }
        }

        // Home Player Ready Handler
        function onHomePlayerReady() {
          console.log('Home YouTube player is ready.');
        }

        // Home Player State Change Handler
        function onHomePlayerStateChange(event) {
          if (event.data === YT.PlayerState.PLAYING) {
            console.log('Home video started playing.');
            // Implement any additional logic if needed
          } else {
            console.log('Home video state changed:', event.data);
          }
        }

        // Function to Load Video into Specific Team POV Slot
        function loadVideoIntoSlot(playerNumber, videoId) {
          console.log(`Loading Video ID: ${videoId} into Slot ${playerNumber}.`);
          try {
            const playerIdentifier = `team-player${playerNumber}`;
            if (players[playerIdentifier] && typeof players[playerIdentifier].loadVideoById === 'function') {
              players[playerIdentifier].loadVideoById(videoId);
              console.log(`Loaded video ID: ${videoId} into existing Slot ${playerNumber}.`);
            } else {
              createPlayer(playerIdentifier, videoId);
            }

            // Add to loadedVideos if not already present
            const videoExists = loadedVideos.some(v => v.id === videoId);
            if (!videoExists) {
              // Fetch video details to get title and thumbnail
              fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`)
                .then(response => {
                  if (!response.ok) {
                    throw new Error(`YouTube oEmbed fetch failed with status ${response.status}`);
                  }
                  return response.json();
                })
                .then(data => {
                  const videoDetails = {
                    id: videoId,
                    title: data.title,
                    thumbnail: data.thumbnail_url,
                    teamView: true
                  };
                  loadedVideos.push(videoDetails);
                  localStorage.setItem('loadedVideos', JSON.stringify(loadedVideos));
                  populateVideoList();
                  showToast(`Loaded video: ${data.title}`, 'success');
                  console.log(`Loaded video: ${data.title} into Slot ${playerNumber}.`);
                })
                .catch(error => {
                  console.error('Error fetching video details:', error);
                  showToast('Failed to load video details.', 'error');
                });
            } else {
              showToast('Video already loaded.', 'info');
              console.log('Video already exists in loadedVideos.');
            }
          } catch (error) {
            console.error(`Error loading video into Slot ${playerNumber}:`, error);
            showToast(`Failed to load video into Slot ${playerNumber}.`, 'error');
          }
        }

        // Function to Add Video Slot in Team POV
        function addVideoSlot(slotNumber) {
          const slotDiv = document.createElement('div');
          slotDiv.classList.add('card', 'bg-base-100', 'shadow-lg', 'p-4');
          slotDiv.innerHTML = `
            <div id="team-player${slotNumber}"></div>
            <button class="btn btn-secondary mt-2 w-full load-video-btn" data-player="${slotNumber}">Load Video into Slot ${slotNumber}</button>
          `;
          document.getElementById('team-video-grid').appendChild(slotDiv);
          console.log(`Added Slot ${slotNumber} to Team POV.`);
        }

        // Function to Populate Team POV Video Grid
        function populateTeamPovList() {
          const teamVideoGrid = document.getElementById('team-video-grid');
          teamVideoGrid.innerHTML = '';

          // Allow up to 12 video slots
          for (let i = 1; i <= 12; i++) {
            addVideoSlot(i);
          }
        }

        // Function to Add Comments to the Feed
        function addCommentToFeed(comment, view = 'home') {
          console.log('Adding comment to feed:', comment);
          const chatBubble = document.createElement('div');
          chatBubble.classList.add('chat', 'chat-end');

          // Map sentiment to DaisyUI chat-bubble color classes
          const bubbleClass = {
            good: 'chat-bubble chat-bubble-success',
            warning: 'chat-bubble chat-bubble-warning',
            bad: 'chat-bubble chat-bubble-error'
          }[comment.sentiment] || 'chat-bubble chat-bubble-primary';

          chatBubble.innerHTML = `
            <div class="${bubbleClass}">
              <strong>${capitalizeFirstLetter(comment.category)}</strong> [${comment.timestamp}]<br>
              <em>By ${comment.author}</em><br>
              ${comment.text}
            </div>
          `;

          if (view === 'home') {
            document.getElementById('comment-feed-home').appendChild(chatBubble);
          } else if (view === 'team-pov') {
            document.getElementById('comment-feed-team').appendChild(chatBubble);
          }
          console.log('Comment added to feed.');
        }

        // Function to Load Comments for a Given Video ID
        function loadCommentsForVideo(videoId, view = 'home') {
          console.log(`Loading comments for Video ID: ${videoId} in ${view} view.`);
          let commentFeed;
          if (view === 'home') {
            commentFeed = document.getElementById('comment-feed-home');
            commentFeed.innerHTML = '';
          } else if (view === 'team-pov') {
            commentFeed = document.getElementById('comment-feed-team');
            commentFeed.innerHTML = '';
          }

          if (commentsData[videoId]) {
            commentsData[videoId].forEach(comment => {
              addCommentToFeed(comment, view);
            });
            console.log(`Loaded ${commentsData[videoId].length} comments.`);
          } else {
            console.log('No comments found for this video.');
          }
        }

        // Comment Form Handling
        document.getElementById('comment-form').addEventListener('submit', function(event) {
          event.preventDefault();
          console.log('Comment form submitted.');

          if (!authorName) {
            promptForAuthorName();
            // After setting the author name, prevent comment submission until name is set
            showToast('Please set your author name in Settings.', 'error');
            console.warn('Author name not set.');
            return;
          }

          if (!currentVideoId) {
            showToast('Please load a video first', 'error');
            console.error('Attempted to add comment without loading a video.');
            return;
          }

          const commentText = document.getElementById('comment-text').value.trim();
          if (!commentText) {
            document.getElementById('comment-error').classList.remove('hidden');
            console.warn('Empty comment submission attempted.');
            return;
          } else {
            document.getElementById('comment-error').classList.add('hidden');
          }

          const comment = {
            text: commentText,
            sentiment: document.getElementById('comment-sentiment').value,
            category: document.getElementById('comment-category').value,
            timestamp: formatTime(players['player-home'].getCurrentTime()),
            author: authorName
          };

          if (!commentsData[currentVideoId]) {
            commentsData[currentVideoId] = [];
          }

          commentsData[currentVideoId].push(comment);
          localStorage.setItem('commentsData', JSON.stringify(commentsData));
          console.log('New comment saved:', comment);

          addCommentToFeed(comment, 'home');

          // Close the modal by unchecking the checkbox
          document.getElementById('commentModalToggle').checked = false;
          console.log('Comment modal closed.');

          showToast('Comment saved successfully!', 'success');
          event.target.reset();
          console.log('Comment form reset.');
        });

        // Function to Prompt for Author Name
        function promptForAuthorName() {
          let name = '';
          while (!name) {
            name = prompt('Please enter your name:', '');
            if (name === null) { // User pressed cancel
              name = 'Anonymous';
              break;
            }
            name = name.trim();
          }
          authorName = name || 'Anonymous';
          localStorage.setItem('authorName', authorName);
          showToast(`Author set to: ${authorName}`, 'success');
          console.log('Author name set:', authorName);
        }

        // Function to Populate Video List in Video List View
        function populateVideoList() {
          // Separate Single View and Team View videos
          const singleViewVideos = loadedVideos.filter(v => !v.teamView);
          const teamViewVideos = loadedVideos.filter(v => v.teamView);

          // Populate Single View Videos
          singleViewContainer.innerHTML = '';
          if (singleViewVideos.length === 0) {
            singleViewContainer.innerHTML = '<p class="text-center text-gray-500">No single view videos loaded.</p>';
          } else {
            singleViewVideos.forEach(video => {
              const videoItem = document.createElement('div');
              videoItem.classList.add('flex', 'items-center', 'justify-between', 'p-2', 'border', 'rounded-lg', 'hover:bg-gray-100');

              videoItem.innerHTML = `
                <div class="flex items-center space-x-4">
                  <img src="${video.thumbnail}" alt="${video.title}" class="w-16 h-9 object-cover rounded">
                  <div>
                    <h3 class="font-semibold">${video.title}</h3>
                    <p class="text-sm text-gray-500">ID: ${video.id}</p>
                  </div>
                </div>
                <div class="flex space-x-2">
                  <button class="btn btn-primary btn-sm goto-video-btn" data-video-id="${video.id}">Go To</button>
                  <button class="btn btn-error btn-sm remove-video-btn" data-video-id="${video.id}" data-video-title="${video.title}">
                    Remove
                  </button>
                </div>
              `;

              singleViewContainer.appendChild(videoItem);
            });
          }

          // Populate Team View Videos
          teamViewVideos.forEach(video => {
            const videoItem = document.createElement('div');
            videoItem.classList.add('flex', 'items-center', 'justify-between', 'p-2', 'border', 'rounded-lg', 'hover:bg-gray-100');

            videoItem.innerHTML = `
              <div class="flex items-center space-x-4">
                <img src="${video.thumbnail}" alt="${video.title}" class="w-16 h-9 object-cover rounded">
                <div>
                  <h3 class="font-semibold">${video.title}</h3>
                  <p class="text-sm text-gray-500">ID: ${video.id}</p>
                </div>
              </div>
              <div class="flex space-x-2">
                <button class="btn btn-primary btn-sm goto-video-btn" data-video-id="${video.id}">Go To</button>
                <button class="btn btn-error btn-sm remove-video-btn" data-video-id="${video.id}" data-video-title="${video.title}">
                  Remove
                </button>
              </div>
            `;

            teamViewContainer.appendChild(videoItem);
          });

          // Add event listeners to all remove buttons
          document.querySelectorAll('.remove-video-btn').forEach(button => {
            button.addEventListener('click', () => {
              const videoId = button.getAttribute('data-video-id');
              const videoTitle = button.getAttribute('data-video-title');
              if (confirm(`Are you sure you want to remove "${videoTitle}"?`)) {
                removeVideo(videoId);
              }
            });
          });

          // Add event listeners to all Go To buttons
          document.querySelectorAll('.goto-video-btn').forEach(button => {
            button.addEventListener('click', () => {
              const videoId = button.getAttribute('data-video-id');
              gotoVideo(videoId);
            });
          });

          console.log('Video list populated.');
        }

        // Function to Remove a Single Video
        function removeVideo(videoId) {
          // Remove from loadedVideos
          loadedVideos = loadedVideos.filter(v => v.id !== videoId);
          localStorage.setItem('loadedVideos', JSON.stringify(loadedVideos));

          // Remove associated comments
          if (commentsData[videoId]) {
            delete commentsData[videoId];
            localStorage.setItem('commentsData', JSON.stringify(commentsData));
          }

          // Remove from Team POV players if loaded
          for (let i = 1; i <= 12; i++) {
            const playerIdentifier = `team-player${i}`;
            if (players[playerIdentifier] && players[playerIdentifier].getVideoData().video_id === videoId) {
              players[playerIdentifier].stopVideo();
              players[playerIdentifier].destroy();
              delete players[playerIdentifier];
              document.getElementById(playerIdentifier).innerHTML = '';
              console.log(`Video removed from Slot ${i}.`);
            }
          }

          // If the removed video is currently playing in Home View, load another video
          if (currentVideoId === videoId) {
            const firstSingleViewVideo = loadedVideos.find(v => !v.teamView);
            if (firstSingleViewVideo) {
              loadVideoById(firstSingleViewVideo.id, firstSingleViewVideo.title);
            } else {
              // No videos left, clear player
              if (players['player-home'] && typeof players['player-home'].destroy === 'function') {
                players['player-home'].destroy();
                delete players['player-home'];
                currentVideoId = null;
                document.getElementById('player-home').innerHTML = '';
                document.getElementById('comment-feed-home').innerHTML = '';
                showToast('No videos loaded. Please add a new video.', 'info');
                console.log('No videos left to play in Home View.');
              }
            }
          }

          // Update UI
          populateVideoList();
          showToast('Video removed successfully.', 'success');
          console.log(`Video with ID ${videoId} removed.`);
        }

        // Function to Clear All Team POV Players
        function clearAllPlayers() {
          for (let i = 1; i <= 12; i++) {
            const playerIdentifier = `team-player${i}`;
            if (players[playerIdentifier] && typeof players[playerIdentifier].destroy === 'function') {
              players[playerIdentifier].destroy();
              delete players[playerIdentifier];
              document.getElementById(playerIdentifier).innerHTML = '';
              console.log(`Cleared Slot ${i}.`);
            }
          }
        }

        // Function to Navigate to a Specific Video
        function gotoVideo(videoId) {
          console.log(`Navigating to video ID: ${videoId}.`);
          // Find the video details
          const video = loadedVideos.find(v => v.id === videoId);
          if (!video) {
            showToast('Video not found.', 'error');
            console.error('Video not found in loadedVideos.');
            return;
          }

          // Load into Home View
          loadVideoById(videoId, video.title);
          // Switch to Home View
          showView('home');
          console.log('Switched to Home view after Go To.');
        }

        // Function to Show Toast Notifications
        function showToast(message, type = 'success') {
          console.log(`Showing toast: ${message} | Type: ${type}`);
          const toastContainer = document.getElementById('toast-container');
          const toast = document.createElement('div');
          toast.className = `alert ${type === 'success' ? 'alert-success' : (type === 'error' ? 'alert-error' : 'alert-info')} shadow-lg`;
          toast.innerHTML = `
            <div>
              <span>${message}</span>
              <button class="btn btn-sm btn-ghost" onclick="this.parentElement.parentElement.remove()" aria-label="Close toast">&times;</button>
            </div>
          `;
          toastContainer.appendChild(toast);
          console.log('Toast added to container.');

          setTimeout(() => {
            toast.remove();
            console.log('Toast removed after timeout.');
          }, 3000);
        }

        // Function to Capitalize First Letter of a String
        function capitalizeFirstLetter(string) {
          if (!string) return '';
          return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Function to Format Seconds to "MM:SS" Format
        function formatTime(seconds) {
          const minutes = Math.floor(seconds / 60);
          const remainingSeconds = Math.floor(seconds % 60);
          const formattedTime = `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
          console.log(`Formatted ${seconds} seconds to "${formattedTime}"`);
          return formattedTime;
        }

        // Function to Update UI After Removing All Videos
        function updateUIAfterRemoval() {
          // Clear Home Player
          if (players['player-home'] && typeof players['player-home'].destroy === 'function') {
            players['player-home'].destroy();
            delete players['player-home'];
            document.getElementById('player-home').innerHTML = '';
            document.getElementById('comment-feed-home').innerHTML = '';
            currentVideoId = null;
          }

          // Clear Team POV Players
          clearAllPlayers();

          // Update Video List
          populateVideoList();

          // Switch to Home View
          showView('home');
        }

        // Function to Add Comment to Team Setup
        function addCommentToTeamSetup(setupId, comment) {
          if (!commentsData[setupId]) {
            commentsData[setupId] = [];
          }
          commentsData[setupId].push(comment);
          localStorage.setItem('commentsData', JSON.stringify(commentsData));
          showToast('Comment added to team setup.', 'success');
          console.log('Comment added to team setup:', comment);
        }

        // YouTube Iframe API Ready Callback
        window.onYouTubeIframeAPIReady = function() {
          console.log('YouTube Iframe API is ready.');
          initializeApp();
        }

        // Function to Initialize the Application
        function initializeApp() {
          // Load Author Name if Exists
          if (!authorName) {
            promptForAuthorName();
          }

          if (loadedVideos.length === 0) {
            // If no videos are loaded, load the default video
            const defaultVideoId = 'TKM4IfADlPk'; // Video ID for https://www.youtube.com/watch?v=TKM4IfADlPk
            const defaultVideo = {
              id: defaultVideoId,
              title: 'Default Video',
              thumbnail: 'https://img.youtube.com/vi/TKM4IfADlPk/mqdefault.jpg',
              teamView: false
            };
            loadedVideos.push(defaultVideo);
            localStorage.setItem('loadedVideos', JSON.stringify(loadedVideos));
            loadVideoById(defaultVideoId, defaultVideo.title);
            showToast('Default video loaded.', 'success');
            console.log('Default video loaded.');
          } else {
            // Optionally, load the first video in the list
            const firstVideo = loadedVideos.find(v => !v.teamView);
            if (firstVideo) {
              loadVideoById(firstVideo.id, firstVideo.title);
              console.log('Loaded first single view video.');
            }
          }
        }

        // Function to Prompt for Author Name
        function promptForAuthorName() {
          let name = '';
          while (!name) {
            name = prompt('Please enter your name:', '');
            if (name === null) { // User pressed cancel
              name = 'Anonymous';
              break;
            }
            name = name.trim();
          }
          authorName = name || 'Anonymous';
          localStorage.setItem('authorName', authorName);
          showToast(`Author set to: ${authorName}`, 'success');
          console.log('Author name set:', authorName);
        }

        // Function to Add Video Slot in Team POV
        function addVideoSlot(slotNumber) {
          const slotDiv = document.createElement('div');
          slotDiv.classList.add('card', 'bg-base-100', 'shadow-lg', 'p-4');
          slotDiv.innerHTML = `
            <div id="team-player${slotNumber}"></div>
            <button class="btn btn-secondary mt-2 w-full load-video-btn" data-player="${slotNumber}">Load Video into Slot ${slotNumber}</button>
          `;
          document.getElementById('team-video-grid').appendChild(slotDiv);
          console.log(`Added Slot ${slotNumber} to Team POV.`);
        }

        // Function to Populate Team POV Video Grid
        function populateTeamPovList() {
          const teamVideoGrid = document.getElementById('team-video-grid');
          teamVideoGrid.innerHTML = '';

          // Allow up to 12 video slots
          for (let i = 1; i <= 12; i++) {
            addVideoSlot(i);
          }

          // Attach event listeners using event delegation
          teamVideoGrid.addEventListener('click', function(event) {
            const button = event.target.closest('.load-video-btn');
            if (button) {
              const playerNumber = button.getAttribute('data-player');
              const videoUrlOrId = prompt(`Enter YouTube Video URL or ID for Slot ${playerNumber}:`);
              if (!videoUrlOrId) {
                console.log(`No input provided for Slot ${playerNumber}.`);
                return;
              }
              const videoId = extractVideoId(videoUrlOrId);
              if (!videoId) {
                showToast('Invalid YouTube Video URL or ID', 'error');
                console.error('Invalid Video ID extracted.');
                return;
              }
              loadVideoIntoSlot(playerNumber, videoId);
            }
          });
        }

        // Function to Save Team Setup
        function saveTeamSetup(videoIds) {
          const setupId = generateTeamSetupId(videoIds);
          localStorage.setItem(`teamSetup-${setupId}`, JSON.stringify(videoIds));
          return setupId;
        }

        // Function to Load Team Setup
        function loadTeamSetup(setupId) {
          const videoIds = JSON.parse(localStorage.getItem(`teamSetup-${setupId}`));
          if (videoIds) {
            clearAllPlayers(); // Clear existing Team POV players
            videoIds.forEach((videoId, index) => {
              if (index < 12) { // Ensure we don't exceed 12 slots
                loadVideoIntoSlot(index + 1, videoId);
              }
            });
            loadCommentsForTeamSetup(setupId);
            showToast('Team setup loaded successfully!', 'success');
            console.log(`Team setup ${setupId} loaded.`);
          } else {
            showToast('Team setup not found.', 'error');
            console.error('Team setup not found.');
          }
        }

        // Function to Handle Team POV Comments (Future Enhancement)
        // This can be expanded to allow adding comments specific to team setups

        // Function to Initialize the Application
        function initializeApp() {
          // Load Author Name if Exists
          if (!authorName) {
            promptForAuthorName();
          }

          if (loadedVideos.length === 0) {
            // If no videos are loaded, load the default video
            const defaultVideoId = 'TKM4IfADlPk'; // Video ID for https://www.youtube.com/watch?v=TKM4IfADlPk
            const defaultVideo = {
              id: defaultVideoId,
              title: 'Default Video',
              thumbnail: 'https://img.youtube.com/vi/TKM4IfADlPk/mqdefault.jpg',
              teamView: false
            };
            loadedVideos.push(defaultVideo);
            localStorage.setItem('loadedVideos', JSON.stringify(loadedVideos));
            loadVideoById(defaultVideoId, defaultVideo.title);
            showToast('Default video loaded.', 'success');
            console.log('Default video loaded.');
          } else {
            // Optionally, load the first video in the list
            const firstVideo = loadedVideos.find(v => !v.teamView);
            if (firstVideo) {
              loadVideoById(firstVideo.id, firstVideo.title);
              console.log('Loaded first single view video.');
            }
          }
        }

        // Function to Extract Video ID from Various YouTube URL Formats
        function extractVideoId(input) {
          const regex = /(?:\?v=|\/embed\/|\.be\/|\/v\/|\/watch\?v=|youtu\.be\/)([^&\n?#]+)/;
          const match = input.match(regex);
          const videoId = match ? match[1] : input;
          console.log(`Extracted Video ID: ${videoId} from input: ${input}`);
          return videoId;
        }

        // Function to Show Toast Notifications
        function showToast(message, type = 'success') {
          console.log(`Showing toast: ${message} | Type: ${type}`);
          const toastContainer = document.getElementById('toast-container');
          const toast = document.createElement('div');
          toast.className = `alert ${type === 'success' ? 'alert-success' : (type === 'error' ? 'alert-error' : 'alert-info')} shadow-lg`;
          toast.innerHTML = `
            <div>
              <span>${message}</span>
              <button class="btn btn-sm btn-ghost" onclick="this.parentElement.parentElement.remove()" aria-label="Close toast">&times;</button>
            </div>
          `;
          toastContainer.appendChild(toast);
          console.log('Toast added to container.');

          setTimeout(() => {
            toast.remove();
            console.log('Toast removed after timeout.');
          }, 3000);
        }

        // Function to Capitalize First Letter of a String
        function capitalizeFirstLetter(string) {
          if (!string) return '';
          return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Function to Format Seconds to "MM:SS" Format
        function formatTime(seconds) {
          const minutes = Math.floor(seconds / 60);
          const remainingSeconds = Math.floor(seconds % 60);
          const formattedTime = `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
          console.log(`Formatted ${seconds} seconds to "${formattedTime}"`);
          return formattedTime;
        }

        // Function to Add Comments to Team POV (Future Enhancement)
        function addCommentToTeamPov(comment) {
          // Implement this function to add comments specific to team setups
        }

        // Function to Populate Video List in Video List View
        function populateVideoList() {
          // Separate Single View and Team View videos
          const singleViewVideos = loadedVideos.filter(v => !v.teamView);
          const teamViewVideos = loadedVideos.filter(v => v.teamView);

          // Populate Single View Videos
          singleViewContainer.innerHTML = '';
          if (singleViewVideos.length === 0) {
            singleViewContainer.innerHTML = '<p class="text-center text-gray-500">No single view videos loaded.</p>';
          } else {
            singleViewVideos.forEach(video => {
              const videoItem = document.createElement('div');
              videoItem.classList.add('flex', 'items-center', 'justify-between', 'p-2', 'border', 'rounded-lg', 'hover:bg-gray-100');

              videoItem.innerHTML = `
                <div class="flex items-center space-x-4">
                  <img src="${video.thumbnail}" alt="${video.title}" class="w-16 h-9 object-cover rounded">
                  <div>
                    <h3 class="font-semibold">${video.title}</h3>
                    <p class="text-sm text-gray-500">ID: ${video.id}</p>
                  </div>
                </div>
                <div class="flex space-x-2">
                  <button class="btn btn-primary btn-sm goto-video-btn" data-video-id="${video.id}">Go To</button>
                  <button class="btn btn-error btn-sm remove-video-btn" data-video-id="${video.id}" data-video-title="${video.title}">
                    Remove
                  </button>
                </div>
              `;

              singleViewContainer.appendChild(videoItem);
            });
          }

          // Populate Team View Videos
          teamViewVideos.forEach(video => {
            const videoItem = document.createElement('div');
            videoItem.classList.add('flex', 'items-center', 'justify-between', 'p-2', 'border', 'rounded-lg', 'hover:bg-gray-100');

            videoItem.innerHTML = `
              <div class="flex items-center space-x-4">
                <img src="${video.thumbnail}" alt="${video.title}" class="w-16 h-9 object-cover rounded">
                <div>
                  <h3 class="font-semibold">${video.title}</h3>
                  <p class="text-sm text-gray-500">ID: ${video.id}</p>
                </div>
              </div>
              <div class="flex space-x-2">
                <button class="btn btn-primary btn-sm goto-video-btn" data-video-id="${video.id}">Go To</button>
                <button class="btn btn-error btn-sm remove-video-btn" data-video-id="${video.id}" data-video-title="${video.title}">
                  Remove
                </button>
              </div>
            `;

            teamViewContainer.appendChild(videoItem);
          });

          // Add event listeners to all remove buttons
          document.querySelectorAll('.remove-video-btn').forEach(button => {
            button.addEventListener('click', () => {
              const videoId = button.getAttribute('data-video-id');
              const videoTitle = button.getAttribute('data-video-title');
              if (confirm(`Are you sure you want to remove "${videoTitle}"?`)) {
                removeVideo(videoId);
              }
            });
          });

          // Add event listeners to all Go To buttons
          document.querySelectorAll('.goto-video-btn').forEach(button => {
            button.addEventListener('click', () => {
              const videoId = button.getAttribute('data-video-id');
              gotoVideo(videoId);
            });
          });

          console.log('Video list populated.');
        }

        // Function to Remove a Single Video
        function removeVideo(videoId) {
          // Remove from loadedVideos
          loadedVideos = loadedVideos.filter(v => v.id !== videoId);
          localStorage.setItem('loadedVideos', JSON.stringify(loadedVideos));

          // Remove associated comments
          if (commentsData[videoId]) {
            delete commentsData[videoId];
            localStorage.setItem('commentsData', JSON.stringify(commentsData));
          }

          // Remove from Team POV players if loaded
          for (let i = 1; i <= 12; i++) {
            const playerIdentifier = `team-player${i}`;
            if (players[playerIdentifier] && players[playerIdentifier].getVideoData().video_id === videoId) {
              players[playerIdentifier].stopVideo();
              players[playerIdentifier].destroy();
              delete players[playerIdentifier];
              document.getElementById(playerIdentifier).innerHTML = '';
              console.log(`Video removed from Slot ${i}.`);
            }
          }

          // If the removed video is currently playing in Home View, load another video
          if (currentVideoId === videoId) {
            const firstSingleViewVideo = loadedVideos.find(v => !v.teamView);
            if (firstSingleViewVideo) {
              loadVideoById(firstSingleViewVideo.id, firstSingleViewVideo.title);
            } else {
              // No videos left, clear player
              if (players['player-home'] && typeof players['player-home'].destroy === 'function') {
                players['player-home'].destroy();
                delete players['player-home'];
                currentVideoId = null;
                document.getElementById('player-home').innerHTML = '';
                document.getElementById('comment-feed-home').innerHTML = '';
                showToast('No videos loaded. Please add a new video.', 'info');
                console.log('No videos left to play in Home View.');
              }
            }
          }

          // Update UI
          populateVideoList();
          showToast('Video removed successfully.', 'success');
          console.log(`Video with ID ${videoId} removed.`);
        }

        // Function to Clear All Team POV Players
        function clearAllPlayers() {
          for (let i = 1; i <= 12; i++) {
            const playerIdentifier = `team-player${i}`;
            if (players[playerIdentifier] && typeof players[playerIdentifier].destroy === 'function') {
              players[playerIdentifier].destroy();
              delete players[playerIdentifier];
              document.getElementById(playerIdentifier).innerHTML = '';
              console.log(`Cleared Slot ${i}.`);
            }
          }
        }

        // Function to Navigate to a Specific Video
        function gotoVideo(videoId) {
          console.log(`Navigating to video ID: ${videoId}.`);
          // Find the video details
          const video = loadedVideos.find(v => v.id === videoId);
          if (!video) {
            showToast('Video not found.', 'error');
            console.error('Video not found in loadedVideos.');
            return;
          }

          // Load into Home View
          loadVideoById(videoId, video.title);
          // Switch to Home View
          showView('home');
          console.log('Switched to Home view after Go To.');
        }

        // Function to Save Team Setup
        function saveTeamSetup(videoIds) {
          const setupId = generateTeamSetupId(videoIds);
          localStorage.setItem(`teamSetup-${setupId}`, JSON.stringify(videoIds));
          return setupId;
        }

        // Function to Show Toast Notifications
        function showToast(message, type = 'success') {
          console.log(`Showing toast: ${message} | Type: ${type}`);
          const toastContainer = document.getElementById('toast-container');
          const toast = document.createElement('div');
          toast.className = `alert ${type === 'success' ? 'alert-success' : (type === 'error' ? 'alert-error' : 'alert-info')} shadow-lg`;
          toast.innerHTML = `
            <div>
              <span>${message}</span>
              <button class="btn btn-sm btn-ghost" onclick="this.parentElement.parentElement.remove()" aria-label="Close toast">&times;</button>
            </div>
          `;
          toastContainer.appendChild(toast);
          console.log('Toast added to container.');

          setTimeout(() => {
            toast.remove();
            console.log('Toast removed after timeout.');
          }, 3000);
        }

        // Function to Capitalize First Letter of a String
        function capitalizeFirstLetter(string) {
          if (!string) return '';
          return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Function to Format Seconds to "MM:SS" Format
        function formatTime(seconds) {
          const minutes = Math.floor(seconds / 60);
          const remainingSeconds = Math.floor(seconds % 60);
          const formattedTime = `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
          console.log(`Formatted ${seconds} seconds to "${formattedTime}"`);
          return formattedTime;
        }

        // Settings Form Handling
        settingsForm.addEventListener('submit', function(event) {
          event.preventDefault();
          const newAuthor = authorInput.value.trim();
          if (!newAuthor) {
            showToast('Author name cannot be empty.', 'error');
            console.warn('Empty author name submission attempted.');
            return;
          }
          authorName = newAuthor;
          localStorage.setItem('authorName', authorName);
          showToast('Settings saved successfully!', 'success');
          console.log('Author name updated:', authorName);
        });

        // Function to Initialize the Application
        function initializeApp() {
          // Load Author Name if Exists
          if (!authorName) {
            promptForAuthorName();
          }

          if (loadedVideos.length === 0) {
            // If no videos are loaded, load the default video
            const defaultVideoId = 'TKM4IfADlPk'; // Video ID for https://www.youtube.com/watch?v=TKM4IfADlPk
            const defaultVideo = {
              id: defaultVideoId,
              title: 'Default Video',
              thumbnail: 'https://img.youtube.com/vi/TKM4IfADlPk/mqdefault.jpg',
              teamView: false
            };
            loadedVideos.push(defaultVideo);
            localStorage.setItem('loadedVideos', JSON.stringify(loadedVideos));
            loadVideoById(defaultVideoId, defaultVideo.title);
            showToast('Default video loaded.', 'success');
            console.log('Default video loaded.');
          } else {
            // Optionally, load the first single view video
            const firstSingleViewVideo = loadedVideos.find(v => !v.teamView);
            if (firstSingleViewVideo) {
              loadVideoById(firstSingleViewVideo.id, firstSingleViewVideo.title);
              console.log('Loaded first single view video.');
            }
          }
        }

        // Function to Load Comments for Team Setup (Future Enhancement)
        function loadCommentsForTeamSetup(setupId) {
          const commentFeed = document.getElementById('comment-feed-team');
          if (!commentFeed) {
            console.error('Comment feed for Team POV not found.');
            return;
          }
          commentFeed.innerHTML = '';

          if (commentsData[setupId]) {
            commentsData[setupId].forEach(comment => {
              addCommentToFeed(comment, 'team-pov');
            });
            console.log(`Loaded ${commentsData[setupId].length} comments for team setup ${setupId}.`);
          } else {
            console.log('No comments found for this team setup.');
          }
        }

        // Initialize the Application
        initializeApp();
      });
    </script>
  </div>
</body>
</html>
